<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:TranslateUI.ViewModels"
        xmlns:conv="using:TranslateUI.Converters"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
        x:Class="TranslateUI.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="{DynamicResource AppTitle}">

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Grid>
        <Grid RowDefinitions="Auto,Auto,*" Margin="16" IsEnabled="{Binding IsNotBusy}">
            <Grid ColumnDefinitions="Auto,Auto,Auto,Auto,*,Auto" ColumnSpacing="12">

            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                <TextBlock Text="{DynamicResource SourceLanguageLabel}"
                           VerticalAlignment="Center"
                           ToolTip.Tip="{DynamicResource TooltipSourceLanguage}" />
                <AutoCompleteBox ItemsSource="{Binding Languages}"
                                 SelectedItem="{Binding SelectedSourceLanguage}"
                                 Width="220"
                                 MinimumPrefixLength="1"
                                 FilterMode="StartsWith"
                                 TextFilter="{Binding FilterLanguage}"
                                 ToolTip.Tip="{DynamicResource TooltipSourceLanguage}">
                    <AutoCompleteBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" />
                        </DataTemplate>
                    </AutoCompleteBox.ItemTemplate>
                </AutoCompleteBox>
            </StackPanel>

            <Button Grid.Column="2"
                    Width="36"
                    Height="32"
                    Content="↔"
                    ToolTip.Tip="{DynamicResource TooltipSwapLanguages}"
                    Command="{Binding SwapLanguagesCommand}" />

            <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                <TextBlock Text="{DynamicResource TargetLanguageLabel}"
                           VerticalAlignment="Center"
                           ToolTip.Tip="{DynamicResource TooltipTargetLanguage}" />
                <AutoCompleteBox ItemsSource="{Binding Languages}"
                                 SelectedItem="{Binding SelectedTargetLanguage}"
                                 Width="220"
                                 MinimumPrefixLength="1"
                                 FilterMode="StartsWith"
                                 TextFilter="{Binding FilterLanguage}"
                                 ToolTip.Tip="{DynamicResource TooltipTargetLanguage}">
                    <AutoCompleteBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" />
                        </DataTemplate>
                    </AutoCompleteBox.ItemTemplate>
                </AutoCompleteBox>
            </StackPanel>

            <StackPanel Grid.Column="4" Spacing="6">
                <TextBlock Text="{DynamicResource ModelLabel}"
                           ToolTip.Tip="{DynamicResource TooltipModelSlider}" />
                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">
                    <TextBlock Text="{DynamicResource SpeedLabel}"
                               VerticalAlignment="Center"
                               ToolTip.Tip="{DynamicResource TooltipModelSlider}" />
                    <Slider Grid.Column="1"
                            Minimum="0"
                            Maximum="2"
                            TickFrequency="1"
                            IsSnapToTickEnabled="True"
                            Value="{Binding SelectedModelIndex}"
                            ToolTip.Tip="{DynamicResource TooltipModelSlider}" />
                    <TextBlock Grid.Column="2"
                               Text="{DynamicResource AccuracyLabel}"
                               VerticalAlignment="Center"
                               ToolTip.Tip="{DynamicResource TooltipModelSlider}" />
                </Grid>
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="{Binding SelectedModelName}"
                               VerticalAlignment="Center"
                               ToolTip.Tip="{DynamicResource TooltipModelSlider}" />
                    <Button Content="{DynamicResource DownloadModelButton}"
                            Width="160"
                            Command="{Binding DownloadModelCommand}"
                            ToolTip.Tip="{DynamicResource TooltipDownloadModel}" />
                </StackPanel>
                <StackPanel Spacing="4" IsVisible="{Binding IsModelDownloading}">
                    <TextBlock Text="{DynamicResource ModelDownloadProgressLabel}"
                               ToolTip.Tip="{DynamicResource TooltipDownloadModel}" />
                    <TextBlock Text="{Binding ModelDownloadStatus}" />
                    <ProgressBar Minimum="0"
                                 Maximum="100"
                                 Value="{Binding ModelDownloadProgress}" />
                </StackPanel>
            </StackPanel>

            <Button Grid.Column="5"
                    Content="⚙"
                    Width="32"
                    Height="32"
                    FontSize="16"
                    HorizontalAlignment="Right"
                    ToolTip.Tip="{DynamicResource TooltipSettings}"
                    Click="OnOpenSettingsClicked" />
            </Grid>

            <StackPanel Grid.Row="1" Spacing="4">
            <TextBlock Text="{Binding ErrorMessageKey, Converter={x:Static conv:ResourceKeyToStringConverter.Instance}}"
                       Foreground="Tomato"
                       IsVisible="{Binding HasError}" />
            <TextBlock Text="{Binding StatusMessageKey, Converter={x:Static conv:ResourceKeyToStringConverter.Instance}}"
                       Foreground="SeaGreen"
                       IsVisible="{Binding HasStatus}" />
            <TextBlock Text="{DynamicResource ModelMissingWarning}"
                       Foreground="Orange"
                       IsVisible="{Binding IsModelMissing}" />
        </StackPanel>

            <TabControl Grid.Row="2" SelectedIndex="{Binding SelectedTabIndex}">
            <TabItem Header="{DynamicResource TextTabHeader}"
                     ToolTip.Tip="{DynamicResource TooltipTextTab}">
                <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="*,*" ColumnSpacing="16" RowSpacing="8">
                    <TextBlock Grid.Row="0"
                               Grid.Column="0"
                               Text="{DynamicResource SourceTextLabel}"
                               ToolTip.Tip="{DynamicResource TooltipSourceText}" />
                    <TextBlock Grid.Row="0"
                               Grid.Column="1"
                               Text="{DynamicResource ResultTextLabel}"
                               ToolTip.Tip="{DynamicResource TooltipResultText}" />

                    <Grid Grid.Row="1" Grid.Column="0">
                        <TextBox Text="{Binding SourceText}"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 VerticalAlignment="Stretch"
                                 ToolTip.Tip="{DynamicResource TooltipSourceText}"
                                 Watermark="{DynamicResource SourceTextPlaceholder}">
                            <TextBox.KeyBindings>
                                <KeyBinding Gesture="Ctrl+Enter" Command="{Binding TranslateCommand}" />
                                <KeyBinding Gesture="Cmd+Enter" Command="{Binding TranslateCommand}" />
                            </TextBox.KeyBindings>
                        </TextBox>
                        <Button Content="▶"
                                Width="36"
                                Height="32"
                                FontSize="16"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                Margin="8"
                                Command="{Binding TranslateCommand}"
                                ToolTip.Tip="{DynamicResource TooltipTranslateButton}" />
                    </Grid>

                    <TextBox Grid.Row="1"
                             Grid.Column="1"
                             Text="{Binding ResultText}"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             VerticalAlignment="Stretch"
                             IsReadOnly="True"
                             ToolTip.Tip="{DynamicResource TooltipResultText}"
                             Watermark="{DynamicResource ResultTextPlaceholder}" />

                    <StackPanel Grid.Row="2"
                                Grid.Column="0"
                                Orientation="Horizontal"
                                Spacing="8">
                        <Button Content="{DynamicResource PasteButton}"
                                Width="120"
                                Command="{Binding PasteSourceCommand}"
                                ToolTip.Tip="{DynamicResource TooltipPaste}" />
                    </StackPanel>

                    <StackPanel Grid.Row="2"
                                Grid.Column="1"
                                Orientation="Horizontal"
                                Spacing="8">
                        <Button Content="{DynamicResource CopyButton}"
                                Width="120"
                                Command="{Binding CopyResultCommand}"
                                ToolTip.Tip="{DynamicResource TooltipCopyResult}" />
                        <Button Content="{DynamicResource SaveButton}"
                                Width="120"
                                Command="{Binding SaveResultCommand}"
                                ToolTip.Tip="{DynamicResource TooltipSaveResult}" />
                        <Button Content="{DynamicResource OpenSavedButton}"
                                Width="140"
                                Command="{Binding OpenSavedResultCommand}"
                                ToolTip.Tip="{DynamicResource TooltipOpenSavedResult}" />
                    </StackPanel>
                </Grid>
            </TabItem>

            <TabItem Header="{DynamicResource FileTabHeader}"
                     ToolTip.Tip="{DynamicResource TooltipFileTab}">
                <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8" RowSpacing="8">
                    <TextBlock Text="{DynamicResource InputFileLabel}"
                               VerticalAlignment="Center"
                               ToolTip.Tip="{DynamicResource TooltipInputFile}" />
                    <TextBox Grid.Column="1"
                             Text="{Binding InputFilePath}"
                             IsReadOnly="True"
                             DragDrop.AllowDrop="True"
                             DragDrop.Drop="OnFileDrop"
                             ToolTip.Tip="{DynamicResource TooltipInputFile}" />
                    <Button Grid.Column="2"
                            Content="{DynamicResource BrowseButton}"
                            Command="{Binding BrowseInputCommand}"
                            ToolTip.Tip="{DynamicResource TooltipBrowseInput}" />

                    <TextBlock Grid.Row="1"
                               Text="{DynamicResource OutputFileLabel}"
                               VerticalAlignment="Center"
                               ToolTip.Tip="{DynamicResource TooltipOutputFile}" />
                    <TextBox Grid.Row="1"
                             Grid.Column="1"
                             Text="{Binding OutputFilePath}"
                             ToolTip.Tip="{DynamicResource TooltipOutputFile}" />
                    <Button Grid.Row="1"
                            Grid.Column="2"
                            Content="{DynamicResource BrowseButton}"
                            Command="{Binding BrowseOutputCommand}"
                            ToolTip.Tip="{DynamicResource TooltipBrowseOutput}" />

                    <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Spacing="8">
                        <Button Content="{DynamicResource TranslateFileButton}"
                                Width="180"
                                Command="{Binding TranslateFileCommand}"
                                ToolTip.Tip="{DynamicResource TooltipTranslateFile}" />
                        <Button Content="{DynamicResource OpenResultButton}"
                                Width="140"
                                Command="{Binding OpenOutputCommand}"
                                ToolTip.Tip="{DynamicResource TooltipOpenResult}" />
                    </StackPanel>
                </Grid>
            </TabItem>

            <TabItem Header="{DynamicResource ImageTabHeader}"
                     ToolTip.Tip="{DynamicResource TooltipImageTab}"
                     IsVisible="{Binding IsImageTabVisible}">
                <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8" RowSpacing="8">
                    <TextBlock Text="{DynamicResource InputFileLabel}"
                               VerticalAlignment="Center"
                               ToolTip.Tip="{DynamicResource TooltipImageFile}" />
                    <TextBox Grid.Column="1"
                             Text="{Binding ImageFilePath}"
                             IsReadOnly="True"
                             DragDrop.AllowDrop="True"
                             DragDrop.Drop="OnImageDrop"
                             ToolTip.Tip="{DynamicResource TooltipImageFile}" />
                    <Button Grid.Column="2"
                            Content="{DynamicResource BrowseButton}"
                            Command="{Binding BrowseImageCommand}"
                            ToolTip.Tip="{DynamicResource TooltipBrowseInput}" />

                    <TextBlock Grid.Row="1"
                               Text="{DynamicResource ResultTextLabel}"
                               VerticalAlignment="Center"
                               ToolTip.Tip="{DynamicResource TooltipResultText}" />
                    <TextBox Grid.Row="1"
                             Grid.Column="1"
                             Grid.ColumnSpan="2"
                             Text="{Binding ImageResultText}"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             VerticalAlignment="Stretch"
                             IsReadOnly="True"
                             ToolTip.Tip="{DynamicResource TooltipResultText}"
                             Watermark="{DynamicResource ResultTextPlaceholder}" />

                    <StackPanel Grid.Row="2"
                                Grid.Column="1"
                                Orientation="Horizontal"
                                Spacing="8">
                        <Button Content="{DynamicResource TranslateImageButton}"
                                Width="200"
                                Command="{Binding TranslateImageCommand}"
                                ToolTip.Tip="{DynamicResource TooltipTranslateImage}" />
                        <Button Content="{DynamicResource CopyButton}"
                                Width="120"
                                Command="{Binding CopyImageResultCommand}"
                                ToolTip.Tip="{DynamicResource TooltipCopyResult}" />
                        <Button Content="{DynamicResource SaveButton}"
                                Width="120"
                                Command="{Binding SaveImageResultCommand}"
                                ToolTip.Tip="{DynamicResource TooltipSaveResult}" />
                    </StackPanel>
                </Grid>
            </TabItem>
            </TabControl>
        </Grid>

        <Border Background="#80000000"
                IsVisible="{Binding IsBusy}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="8">
                <ProgressBar IsIndeterminate="True" Width="240" />
                <TextBlock Text="{DynamicResource TranslatingStatus}" Foreground="White" />
            </StackPanel>
        </Border>
    </Grid>

</Window>
